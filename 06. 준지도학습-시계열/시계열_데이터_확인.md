# 시계열 분석 개요

## #01. 시계열 자료의 이해

- 시간의 흐름에 따라 관찰된 값들
- 시계열 데이터의 분석을 통해 미래의 값을 예측하고 경향, 주기, 계절성 등을 파악하여 활용한다.

### [1] 시계열 자료의 종류

| 종류 | 설명 |
|--|--|
| `비정상성` 시계열 자료 | 시계열 분석을 실시할 때 다루기 어려운 자료로 대부분의 시계열 자료 |
| `정상성` 시계열 자료 | 비정상 시계열을 핸들링해 다루기 쉬운 시계열 자료로 변환한 자료 |

시계열 분석에서는 거의 모든 데이터가 비정상성이다. 그러므로 이 데이터를 정상성 자료로 변환해야 한다.

### [2] 정상성의 이해

평균과 분산이 일정하고 공분산도 단지 시차에만 의존하고 특정 시점에는 의존하지 않는 상태

#### (1) 평균이 일정할 경우

- 모든 시점에 대해 일정한 평균을 갖는다
- 실제 대부분의 자료는 평균이 일정하지 않다. 이 경우 차분(Difference)을 통해 정상화 할 수 있다.

#### (2) 분산이 일정할 경우

- 분산도 특정 시점에 의존하지 않고 일정해야 한다.
- 분산이 일정하지 않을 경우 변환(Transformation)을 통해 정상화 할 수 있다.

#### (3) 약한 의미의 정상성(약정상성)

모든 시점에 평균 일정, 시점과 분산 독립, 공분산은 시차에만 의존

### [3] ADF 테스트

시계열 데이터의 정상성 여부를 판단하기 위한 검정

#### ADF 테스트의 가설

| 가설 | 내용 |
|---|---|
| 귀무가설 | 데이터가 정상성과 다르다 (=비정상성임을 의미) |
| 대립가설 | 데이터가 정상성이다. |

### [4] 비정상 데이터를 정상 데이터로 바꾸기

| 이름 | 설명 |
|--|--|
| 변환(transformation) | 분산이 일정하지 않은 비정상 시계열에 대해 수행 |
| 차분(difference) | 평균이 일정하지 않은 비정상 시계열에 대해 수행 |
| 일반차분 (regular difference) | 바로 전 시점의 자료를 빼는 방법이다 |
| 계절차분 (seasonal difference) | 여러 시점 전의 자료를 빼는 것 방법 , 주로 계절성을 갖는 자료를 정상화 하는데 사용한다 |

#### 정상 시계열로의 변환 과정

![img](res/img.png)

| 구분 | 설명 |
|---|---|
| (a) | 일반적으로 수집되는 비정상 시계열. 시간에 따라 변동폭이 일정하지 않고, 추세와 계절적 영향이 존재하는 형태 |
| (b) | (a)상태의 비정상 시계열에 로그 변환을 수행하여 변동폭을 일정하게 변경한 상태<br/>변환을 수행하여 평균을 일정하게 처리함 | 
| (c) | (a)상태의 비정상 시계열에 차분을 수행하여 평균을 일정하게 맞춘 상태. 1차 차분으로 정상성을 띄지 않으면 반복 수행한다. (n차) |
| (d) | (b),(c)를 함께 적용하여 정상 시계열로 변한한 상태 |

## #02. 시계열 분석 방법

### [1] 시계열 분석 방법의 종류

| 종류 | 설명 |
|---|---|
| 평균이동법 | 과거로부터 현재까지의 시계열 데이터를 대상으로 일정기간별 이동평균을 계산하고 이들의 추세를 파악하여 다음 기간을 예측하는 방법.<br>가장 고전적인 예측 방법 |
| 지수평활법 | 일정기간의 평균을 이용하는 이동평균법과 달리 모든 시계열 자료를 사용하여 평균을 구한다. 시간의 흐름에 따라 최근 시계열에 더 많은 가중치를 부여하여 미래를 예측하는 방법 |
| 분해 시계열 | 시계열에 영향을 주는 일반적인 요인을 시계열에서 분리해 분석하는 방법 |
| 통계적 모형 활용 | 자기회귀모형(AR), 이동평균모형(MA) 자기회귀누적이동평균모형(ARIMA), 계량경제 모형 등 |

### [2] 분해 시계열

시계열에 영향을 주는 일반적인 요인을 시계열에서 분리해 분석하는 방법

시계열 자료를 추세(Trend), 계절성(Seasonal), 잔차(Rasid)로 분해하는 데이터 전처리 방법

- 분해시계열분석법에서는 각 구성요인을 정확히 분리하는 것이 중요
- 요인 정확히 분리하기 쉽지 않으며 이론적 약점 존재 but 많이 사용됨

#### (1) 분해된 시계열의 구성 요소 

| 요소 | 설명 |
|---|---|
| 추세요인(trend factor) | 자료가 어떤 특정한 형태를 취할 때 |
| 계절요인(seasonal factor) | 고정된 주기에 따라 자료가 변화 |
| 불규칙요인(irregular factor) | 회귀분석에서 잔차에 해당하는 요인 |


#### (2) 시계열 분해 방법

| 구분 | 설명 |
|--|--|
| 가법모델(Additive Model) | 시계열 데이터를 구성하는 각 성분이 덧셈을 통해 연결되어 있다고 가정 |
| 승법모델(Multiplicative Model) | 각 성분이 곱셈을 통해 연결되어 있다고 가정<br/>승법 모델은 로그 변환을 통해 가법 모델로 쉽게 변환 가능함 |

모델 선택은 시계열 데이터의 특성을 고려하면 되는데, 아래 그림의 왼편 그래프와 같이 시간에 따른 데이터 변동이 일정한 경우는 가법 모델을 활용한 데이터 분해가 적합함

![model](res/model.png)

### [3] 통계적 시계열 분석 방법

#### (1) AR 모형 (자기회귀모형)

- 특정 시점 전의 자료가 현재 자료에 영향을 주는 형태
- 판단조건 : 자기상관함수(ACF)가 빠르게 감소하고 부분자기상관함수(PACF)는 어느 시점에 절단점을 갖음

![m1](res/m1.png)

#### (2) MA 모형 (이동평균모형)

- 유한한 개수의 백색잡음의 결합.
- 항상 정상성을 만족
- ACF에서 절단점 갖고 PACF가 빠르게 감소

![m2](res/m2.png)

#### (3) ARIMA 모형 (자기회귀누적이동평균모형)

- 가장 일반적인 모형 (이것만 사용)
- 비정상시계열 모형
- 차분이나 변환을 통해 AR/MA/ARMA 모형으로 정상화 가능
- 세가지 지표를 사용하는 $(p,d,q)$ 모형이라고도 함

$p$는 AR 모형과 관련 있는 차수.

$q$는 MA 모형과 관련 있는 차수.

$p$와 $q$는 ARIMA 모형에서 ARMA로 정상화 할 때 차분한 횟수를 의미

| 종류 | 의미 |
|---|---|
| $p=0$ | $IMA(d,q)$ 모형이라고 부르고, $d$번 차분하면 $MA(q)$ 모형을 따른다 |
| $d=0$ | $ARMA(p,q)$ 모형이라 부르고，이모형은 정상성을 만족한다. |
| $q=0$ | $ARI(p,d)$ 모형이라 부르고, $d$번 차분하면 $AR(p)$ 모형을 따른다. |

#### 예시

| 예 | 내용 |
|--|--|
| $ARIMA(0, 1, 1)$ | 1차분 후 $MA(1)$모형을 활용 |
| $ARIMA(1, 1, 0)$ | 1차분 후 $AR(1)$모형을 활용 |

### [4] Prohet

메타(페이스북)에서 발표한 시계열 분석 머신러닝 라이브러리

시계열 분석에서는 거의 사기템 수준

```shell
pip install prophet
```

#### 레퍼런스 사이트

> https://facebook.github.io/prophet/

#### 관련 논문

> https://peerj.com/preprints/3190.pdf